#!/bin/bash

# Directory where your video files are stored
VIDEO_DIR="/mnt/harddisk"

# File to store the state of the script
STATE_FILE="$HOME/.video_script_state"

# Check if the state file exists
if [ -f "$STATE_FILE" ]; then
    # Read the last processed video file from the state file
    last_video_file=$(tail -n 1 "$STATE_FILE")

    # Find all video files from the last processed file onwards
    video_files=$(locate -d ~/.config/.mymlocate.db -b -r '.*\.\(mp4\|mkv\|webm\|mov\|m4v\|wmv\|flv\|avi\)$' | awk -v last="$last_video_file" '$0 ~ last { p=1 } p')

    # Remove the state file since it will be updated
    rm "$STATE_FILE"
else
    # Find all video files from the beginning
    video_files=$(locate -d ~/.config/.mymlocate.db -b -r '.*\.\(mp4\|mkv\|webm\|mov\|m4v\|wmv\|flv\|avi\)$')
fi

# Open videos with mpv and update the state file
IFS=$'\n'
for video_file in $video_files; do
    full_path="$VIDEO_DIR/${video_file}"
    mpv "$full_path"

    # Prompt for deletion
    while true; do
        read -p "Do you want to delete this video? [y/n]: " choice
        case $choice in
            [Yy]* )
                rm "$full_path"
                echo "Video deleted."
                break
                ;;
            [Nn]* )
                echo "Video not deleted."
                break
                ;;
            * )
                echo "Please answer with 'y' or 'n'."
                ;;
        esac
    done

    # Update the state file with the current video file
    echo "$video_file" >> "$STATE_FILE"
done
unset IFS
