#!/bin/sh

find . -depth -name '*.cue' -print0 | xargs -0 -n1 -I{} sh -c '
    process_cue_file() {
        cue_file_path="$1"
        dir_name=$(dirname "$cue_file_path")
        flac_file=$(find "$dir_name" -maxdepth 1 -type f -name "*.flac" | head -n 1)
        if [ -n "$flac_file" ]; then
            flac_file_name=$(basename "$flac_file")
            sed -i -E "/^FILE/ s#\"([^\"]*)\"#\"$flac_file_name\"#g" "$cue_file_path"
        fi
    }
    process_cue_file "{}"
'
